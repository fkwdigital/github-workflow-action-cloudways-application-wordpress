{"version":3,"file":"index.js","mappings":";;;;;;AAAA;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC5JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AClMA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7BA;AACA;;;;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":[".././node_modules/command-exists/index.js",".././node_modules/command-exists/lib/command-exists.js",".././node_modules/rsyncwrapper/lib/rsyncwrapper.js","../external node-commonjs \"child_process\"","../external node-commonjs \"fs\"","../external node-commonjs \"os\"","../external node-commonjs \"path\"","../webpack/bootstrap","../webpack/runtime/compat",".././src/index.js"],"sourcesContent":["module.exports = require('./lib/command-exists');\n","'use strict';\n\nvar exec = require('child_process').exec;\nvar execSync = require('child_process').execSync;\nvar fs = require('fs');\nvar path = require('path');\nvar access = fs.access;\nvar accessSync = fs.accessSync;\nvar constants = fs.constants || fs;\n\nvar isUsingWindows = process.platform == 'win32'\n\nvar fileNotExists = function(commandName, callback){\n    access(commandName, constants.F_OK,\n    function(err){\n        callback(!err);\n    });\n};\n\nvar fileNotExistsSync = function(commandName){\n    try{\n        accessSync(commandName, constants.F_OK);\n        return false;\n    }catch(e){\n        return true;\n    }\n};\n\nvar localExecutable = function(commandName, callback){\n    access(commandName, constants.F_OK | constants.X_OK,\n        function(err){\n        callback(null, !err);\n    });\n};\n\nvar localExecutableSync = function(commandName){\n    try{\n        accessSync(commandName, constants.F_OK | constants.X_OK);\n        return true;\n    }catch(e){\n        return false;\n    }\n}\n\nvar commandExistsUnix = function(commandName, cleanedCommandName, callback) {\n\n    fileNotExists(commandName, function(isFile){\n\n        if(!isFile){\n            var child = exec('command -v ' + cleanedCommandName +\n                  ' 2>/dev/null' +\n                  ' && { echo >&1 ' + cleanedCommandName + '; exit 0; }',\n                  function (error, stdout, stderr) {\n                      callback(null, !!stdout);\n                  });\n            return;\n        }\n\n        localExecutable(commandName, callback);\n    });\n\n}\n\nvar commandExistsWindows = function(commandName, cleanedCommandName, callback) {\n  // Regex from Julio from: https://stackoverflow.com/questions/51494579/regex-windows-path-validator\n  if (!(/^(?!(?:.*\\s|.*\\.|\\W+)$)(?:[a-zA-Z]:)?(?:(?:[^<>:\"\\|\\?\\*\\n])+(?:\\/\\/|\\/|\\\\\\\\|\\\\)?)+$/m.test(commandName))) {\n    callback(null, false);\n    return;\n  }\n  var child = exec('where ' + cleanedCommandName,\n    function (error) {\n      if (error !== null){\n        callback(null, false);\n      } else {\n        callback(null, true);\n      }\n    }\n  )\n}\n\nvar commandExistsUnixSync = function(commandName, cleanedCommandName) {\n  if(fileNotExistsSync(commandName)){\n      try {\n        var stdout = execSync('command -v ' + cleanedCommandName +\n              ' 2>/dev/null' +\n              ' && { echo >&1 ' + cleanedCommandName + '; exit 0; }'\n              );\n        return !!stdout;\n      } catch (error) {\n        return false;\n      }\n  }\n  return localExecutableSync(commandName);\n}\n\nvar commandExistsWindowsSync = function(commandName, cleanedCommandName, callback) {\n  // Regex from Julio from: https://stackoverflow.com/questions/51494579/regex-windows-path-validator\n  if (!(/^(?!(?:.*\\s|.*\\.|\\W+)$)(?:[a-zA-Z]:)?(?:(?:[^<>:\"\\|\\?\\*\\n])+(?:\\/\\/|\\/|\\\\\\\\|\\\\)?)+$/m.test(commandName))) {\n    return false;\n  }\n  try {\n      var stdout = execSync('where ' + cleanedCommandName, {stdio: []});\n      return !!stdout;\n  } catch (error) {\n      return false;\n  }\n}\n\nvar cleanInput = function(s) {\n  if (/[^A-Za-z0-9_\\/:=-]/.test(s)) {\n    s = \"'\"+s.replace(/'/g,\"'\\\\''\")+\"'\";\n    s = s.replace(/^(?:'')+/g, '') // unduplicate single-quote at the beginning\n      .replace(/\\\\'''/g, \"\\\\'\" ); // remove non-escaped single-quote if there are enclosed between 2 escaped\n  }\n  return s;\n}\n\nif (isUsingWindows) {\n  cleanInput = function(s) {\n    var isPathName = /[\\\\]/.test(s);\n    if (isPathName) {\n      var dirname = '\"' + path.dirname(s) + '\"';\n      var basename = '\"' + path.basename(s) + '\"';\n      return dirname + ':' + basename;\n    }\n    return '\"' + s + '\"';\n  }\n}\n\nmodule.exports = function commandExists(commandName, callback) {\n  var cleanedCommandName = cleanInput(commandName);\n  if (!callback && typeof Promise !== 'undefined') {\n    return new Promise(function(resolve, reject){\n      commandExists(commandName, function(error, output) {\n        if (output) {\n          resolve(commandName);\n        } else {\n          reject(error);\n        }\n      });\n    });\n  }\n  if (isUsingWindows) {\n    commandExistsWindows(commandName, cleanedCommandName, callback);\n  } else {\n    commandExistsUnix(commandName, cleanedCommandName, callback);\n  }\n};\n\nmodule.exports.sync = function(commandName) {\n  var cleanedCommandName = cleanInput(commandName);\n  if (isUsingWindows) {\n    return commandExistsWindowsSync(commandName, cleanedCommandName);\n  } else {\n    return commandExistsUnixSync(commandName, cleanedCommandName);\n  }\n};\n","'use strict'\n\nvar spawn = require('child_process').spawn\n\nvar escapeSpaces = function(path) {\n  if (typeof path === 'string') {\n    return path.replace(/\\b\\s/g, '\\\\ ')\n  } else {\n    return path\n  }\n}\n\nvar escapeSpacesInOptions = function(options) {\n  // Escape paths in the src, dest, include, exclude, and excludeFirst arguments\n  ;['src', 'dest', 'include', 'exclude', 'excludeFirst'].forEach(function(\n    optionKey\n  ) {\n    var option = options[optionKey]\n    if (typeof option === 'string') {\n      options[optionKey] = escapeSpaces(option)\n    } else if (Array.isArray(option) === true) {\n      options[optionKey] = option.map(escapeSpaces)\n    }\n  })\n\n  return options\n}\n\nmodule.exports = function(options, callback) {\n  options = options || {}\n  options = Object.assign({}, options)\n  options = escapeSpacesInOptions(options)\n\n  var platform = options.platform || process.platform // Enable process.platform to be mocked in options for testing\n  var isWin = platform === 'win32'\n\n  if (typeof options.src === 'undefined') {\n    throw new Error(\"'src' directory is missing from options\")\n  }\n\n  if (typeof options.dest === 'undefined') {\n    throw new Error(\"'dest' directory is missing from options\")\n  }\n\n  var dest = options.dest\n\n  if (typeof options.host !== 'undefined') {\n    dest = options.host + ':' + options.dest\n  }\n\n  if (!Array.isArray(options.src)) {\n    options.src = [options.src]\n  }\n\n  var args = [].concat(options.src)\n\n  args.push(dest)\n\n  // [rsync failed on windows, copying persmissions](https://github.com/jedrichards/rsyncwrapper/issues/28)\n  // [set chmod flag by default on Windows](https://github.com/jedrichards/rsyncwrapper/pull/29)\n  var chmodArg = (options.args || []).find(function(arg) {\n    return arg.match(/--chmod=/)\n  })\n  if (isWin && !chmodArg) {\n    args.push('--chmod=ugo=rwX')\n  }\n\n  if (typeof options.host !== 'undefined' || options.ssh) {\n    args.push('--rsh')\n    var rshCmd = 'ssh'\n    if (typeof options.port !== 'undefined') {\n      rshCmd += ' -p ' + options.port\n    }\n    if (typeof options.privateKey !== 'undefined') {\n      rshCmd += ' -i ' + options.privateKey\n    }\n    if (typeof options.sshCmdArgs !== 'undefined') {\n      rshCmd += ' ' + options.sshCmdArgs.join(' ')\n    }\n    args.push(rshCmd)\n  }\n\n  if (options.recursive === true) {\n    args.push('--recursive')\n  }\n\n  if (options.times === true) {\n    args.push('--times')\n  }\n\n  if (options.syncDest === true || options.deleteAll === true) {\n    args.push('--delete')\n    args.push('--delete-excluded')\n  }\n\n  if (options.syncDestIgnoreExcl === true || options.delete === true) {\n    args.push('--delete')\n  }\n\n  if (options.dryRun === true) {\n    args.push('--dry-run')\n    args.push('--verbose')\n  }\n\n  if (\n    typeof options.excludeFirst !== 'undefined' &&\n    Array.isArray(options.excludeFirst)\n  ) {\n    options.excludeFirst.forEach(function(value, index) {\n      args.push('--exclude=' + value)\n    })\n  }\n\n  if (typeof options.include !== 'undefined' && Array.isArray(options.include)) {\n    options.include.forEach(function(value, index) {\n      args.push('--include=' + value)\n    })\n  }\n\n  if (typeof options.exclude !== 'undefined' && Array.isArray(options.exclude)) {\n    options.exclude.forEach(function(value, index) {\n      args.push('--exclude=' + value)\n    })\n  }\n\n  switch (options.compareMode) {\n    case 'sizeOnly':\n      args.push('--size-only')\n      break\n    case 'checksum':\n      args.push('--checksum')\n      break\n  }\n\n  if (typeof options.args !== 'undefined' && Array.isArray(options.args)) {\n    args = [...new Set([...args, ...options.args])]\n  }\n\n  args = [...new Set(args)]\n\n  var noop = function() {}\n  var onStdout = options.onStdout || noop\n  var onStderr = options.onStderr || noop\n\n  var cmd = 'rsync '\n  args.forEach(function(arg) {\n    if (arg.substr(0, 4) === 'ssh ') {\n      arg = '\"' + arg + '\"'\n    }\n    cmd += arg + ' '\n  })\n  cmd = cmd.trim()\n\n  if (options.noExec) {\n    callback(null, null, null, cmd)\n    return\n  }\n\n  try {\n    var stdout = ''\n    var stderr = ''\n    // Launch cmd in a shell just like Node's child_process.exec() does:\n    // see https://github.com/joyent/node/blob/937e2e351b2450cf1e9c4d8b3e1a4e2a2def58bb/lib/child_process.js#L589\n    var child\n    if (isWin) {\n      child = spawn('cmd.exe', ['/s', '/c', '\"' + cmd + '\"'], {\n        windowsVerbatimArguments: true,\n        stdio: [process.stdin, 'pipe', 'pipe'],\n      })\n    } else {\n      child = spawn('/bin/sh', ['-c', cmd])\n    }\n\n    child.stdout.on('data', function(data) {\n      onStdout(data)\n      stdout += data\n    })\n\n    child.stderr.on('data', function(data) {\n      onStderr(data)\n      stderr += data\n    })\n\n    child.on('exit', function(code) {\n      var err = null\n      if (code !== 0) {\n        err = new Error('rsync exited with code ' + code)\n        err.code = code\n      }\n      callback(err, stdout, stderr, cmd)\n    })\n  } catch (err) {\n    callback(err, null, null, cmd)\n  }\n}\n","module.exports = require(\"child_process\");","module.exports = require(\"fs\");","module.exports = require(\"os\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\tvar threw = true;\n\ttry {\n\t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\t\tthrew = false;\n\t} finally {\n\t\tif(threw) delete __webpack_module_cache__[moduleId];\n\t}\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = __dirname + \"/\";","'use strict';\n\nconst path = require('path');\nconst fs = require('fs');\nconst { exec } = require('child_process');\nconst rsync = require('rsyncwrapper');\nconst { sync: commandExists } = require('command-exists');\n\n/* ----------------- helpers ----------------- */\nfunction validateDir(dir) {\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n}\nfunction validateFile(filePath) {\n  if (!fs.existsSync(filePath)) fs.writeFileSync(filePath, '', { encoding: 'utf8', mode: 0o600 });\n}\nfunction addSshKey(key, name) {\n  const home = process.env.HOME || require('os').homedir();\n  const sshDir = path.join(home, '.ssh');\n  validateDir(sshDir);\n  validateFile(path.join(sshDir, 'known_hosts'));\n  const filePath = path.join(sshDir, name || 'deploy_key');\n  fs.writeFileSync(filePath, key, { encoding: 'utf8', mode: 0o600 });\n  return filePath;\n}\nfunction ensureRsync(cb) {\n  if (commandExists('rsync')) return cb();\n  exec('sudo apt-get update && sudo apt-get --no-install-recommends install -y rsync', (err) => {\n    if (err) {\n      console.error('⚠️  [CLI] rsync install failed:', err.message);\n      process.abort();\n    }\n    console.log('✅ [CLI] rsync installed');\n    cb();\n  });\n}\nfunction readExcludeFile(workspace, relPath) {\n  if (!relPath) return [];\n  const p = path.isAbsolute(relPath) ? relPath : path.join(workspace, relPath);\n  if (!fs.existsSync(p)) return [];\n  return fs\n    .readFileSync(p, 'utf8')\n    .split(/\\r?\\n/)\n    .map((l) => l.trim())\n    .filter((l) => l && !l.startsWith('#'));\n}\nfunction withTrailingSlash(p) {\n  return p && !p.endsWith('/') ? `${p}/` : p;\n}\nfunction splitArgs(argStr) {\n  // turn \"--exclude='.*' --no-perms\" into [\"--exclude=.*\",\"--no-perms\"]\n  return (argStr || '')\n    .split(/\\s+/)\n    .filter(Boolean)\n    .map((a) => a.replace(/^['\"]|['\"]$/g, ''))\n    .map((a) => a.replace(/=(['\"])(.*)\\1$/, '=$2'));\n}\n\n/* --------- enforced WP/core excludes ---------- */\nconst ALWAYS_EXCLUDE = [\n  '*~',\n  '.git',\n  '.github',\n  '.gitignore',\n  '.DS_Store',\n  '.svn',\n  '.cvs',\n  '*.bak',\n  '*.swp',\n  'Thumbs.db',\n  '*.log',\n  '.env',\n  '.smushit-status',\n  '.gitattributes',\n  'db-config.php',\n  'index.php',\n  'wp-activate.php',\n  'wp-admin/',\n  'wp-app.php',\n  'wp-atom.php',\n  'wp-blog-header.php',\n  'wp-comments-post.php',\n  'wp-commentsrss2.php',\n  'wp-config.php',\n  'wp-content/advanced-cache.php',\n  'wp-content/backup-db/',\n  'wp-content/blogs.dir/',\n  'wp-content/breeze-config/',\n  'wp-content/cache/',\n  'wp-content/drop-ins/',\n  'wp-content/index.php',\n  'wp-content/mu-plugins/',\n  'wp-content/mysql.sql',\n  'wp-content/object-cache.php',\n  'wp-content/plugins/',\n  'wp-content/themes/index.php',\n  'wp-content/themes/twenty*',\n  'wp-content/themes/variations/',\n  'wp-content/upgrade*',\n  'wp-content/uploads/',\n  'wp-content/webp-express',\n  'wp-content/wp-cache-config.php',\n  'wp-cron.php',\n  'wp-feed.php',\n  'wp-includes/',\n  'wp-links-opml.php',\n  'wp-load.php',\n  'wp-login.php',\n  'wp-mail.php',\n  'wp-pass.php',\n  'wp-rdf.php',\n  'wp-register.php',\n  'wp-rss.php',\n  'wp-rss2.php',\n  'wp-salt.php',\n  'wp-settings.php',\n  'wp-signup.php',\n  'wp-trackback.php',\n  'xmlrpc.php',\n];\n\n/* -------------------- main -------------------- */\nfunction main() {\n  const env = process.env;\n  const IN = (k, d = '') => env[k] || env[`INPUT_${k}`] || d;\n  const WORKSPACE = env.GITHUB_WORKSPACE || process.cwd();\n\n  const cfg = {\n    host: IN('REMOTE_HOST'),\n    user: IN('REMOTE_USER'),\n    port: IN('REMOTE_PORT', '22'),\n    key: IN('SSH_PRIVATE_KEY'),\n    keyName: IN('DEPLOY_KEY_NAME', 'deploy_key'),\n\n    // you won’t set TARGET or TARGET_BASE in your flow; kept for fallback/compat\n    target: IN('TARGET'),\n    targetBase: IN('TARGET_BASE', ''),\n    folderName: IN('FOLDER_NAME', ''),\n\n    source: IN('SOURCE', 'public/'),\n    rsyncArgs:\n      IN('ARGS') || IN('RSYNC_ARGS', \"-azvr --inplace --exclude='.*' --no-perms --no-times\"),\n    extraExclude: IN('EXTRA_EXCLUDE', ''),\n    excludeFile: IN('EXCLUDE_FILE', ''),\n  };\n\n  // required inputs\n  [\n    ['host', 'REMOTE_HOST'],\n    ['user', 'REMOTE_USER'],\n    ['key', 'SSH_PRIVATE_KEY'],\n  ].forEach(([k, label]) => {\n    if (!cfg[k]) {\n      console.error(`⚠️  [INPUTS] Missing required input: ${label}`);\n      process.abort();\n    }\n  });\n\n  // compute remote destination\n  function computeDest() {\n    // 1) explicit TARGET wins if provided\n    if (cfg.target) return cfg.target.endsWith('/') ? cfg.target : `${cfg.target}/`;\n    // 2) your desired default from FOLDER_NAME\n    if (cfg.folderName) {\n      const p = `applications/${cfg.folderName}/public_html`;\n      return p.endsWith('/') ? p : `${p}/`;\n    }\n    // 3) (optional) TARGET_BASE + FOLDER_NAME if someone uses it\n    if (cfg.targetBase) {\n      const appended = cfg.folderName\n        ? path.posix.join(cfg.targetBase, cfg.folderName)\n        : cfg.targetBase;\n      return appended.endsWith('/') ? appended : `${appended}/`;\n    }\n    // 4) fallback\n    return `/home/${cfg.user}/`;\n  }\n\n  const remoteDest = `${cfg.user}@${cfg.host}:${computeDest()}`;\n  const localSrc = path.posix.join(WORKSPACE, withTrailingSlash(cfg.source || ''));\n\n  // build excludes\n  const fileEx = readExcludeFile(WORKSPACE, cfg.excludeFile);\n  const extra = cfg.extraExclude\n    ? cfg.extraExclude\n        .split(',')\n        .map((s) => s.trim())\n        .filter(Boolean)\n    : [];\n  const EXCLUDES = [...ALWAYS_EXCLUDE, ...fileEx, ...extra];\n\n  console.log(`[deploy] Source   → ${localSrc}`);\n  console.log(`[deploy] Dest     → ${remoteDest}`);\n  console.log(`[deploy] Rsync    → ${cfg.rsyncArgs}`);\n  console.log(`[deploy] Excludes → ${EXCLUDES.length} (always + file + extra)`);\n\n  const keyPath = addSshKey(cfg.key, cfg.keyName);\n  const home = env.HOME || require('os').homedir();\n  validateDir(path.join(home, '.ssh'));\n  validateFile(path.join(home, '.ssh', 'known_hosts'));\n\n  ensureRsync(() => {\n    try {\n      rsync(\n        {\n          src: localSrc,\n          dest: remoteDest,\n          args: splitArgs(cfg.rsyncArgs),\n          privateKey: keyPath,\n          port: cfg.port,\n          excludeFirst: EXCLUDES,\n          ssh: true,\n          sshCmdArgs: ['-o', 'StrictHostKeyChecking=no'],\n          recursive: true,\n        },\n        (error, stdout, stderr, cmd) => {\n          if (error) {\n            console.error('⚠️  [rsync] error:', error.message);\n            console.error('stderr:', stderr || '');\n            console.error('cmd:', cmd || '');\n            process.abort();\n          } else {\n            console.log('✅ [rsync] completed\\n', stdout || '');\n          }\n        }\n      );\n    } catch (e) {\n      console.error('⚠️  [rsync] threw:', e.message);\n      process.abort();\n    }\n  });\n}\n\nmain();\n"],"names":[],"sourceRoot":""}